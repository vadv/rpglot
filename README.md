# rpglot

**rpglot** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã –∏ PostgreSQL, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ Rust. –í–¥–æ—Ö–Ω–æ–≤–ª—ë–Ω [atop](https://github.com/Atoptool/atop), –Ω–æ —Å –≥–ª—É–±–æ–∫–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π PostgreSQL.

![rpglot TUI](docs/screenshot.png)

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫ I/O)
- üêò –ì–ª—É–±–æ–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL (pg_stat_activity, pg_stat_statements)
- üìÅ –ó–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫ –Ω–∞ –¥–∏—Å–∫ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- üñ•Ô∏è –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π TUI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ —Å—Ç–∏–ª–µ atop/htop
- üê≥ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–π —Å—Ä–µ–¥—ã (cgroup)
- üîó Drill-down –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –∏ PostgreSQL —Å–µ—Å—Å–∏—è–º–∏

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Å–±–æ—Ä–∫–∞

```bash
# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
cargo build --release

# –ë–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –≤ target/release/
# rpglotd - –¥–µ–º–æ–Ω —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
# rpglot  - TUI-–ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: –¥–≤–∞ –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–∞

### rpglotd ‚Äî –¥–µ–º–æ–Ω —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫

–§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö –Ω–∞ –¥–∏—Å–∫.

```bash
# –ó–∞–ø—É—Å–∫ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∏–Ω—Ç–µ—Ä–≤–∞–ª 10 —Å–µ–∫, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è ./data)
rpglotd

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
rpglotd -i 5 -o /var/lib/rpglot     # –∏–Ω—Ç–µ—Ä–≤–∞–ª 5 —Å–µ–∫, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /var/lib/rpglot

# –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –º–æ–∫-–¥–∞–Ω–Ω—ã–º–∏ /proc
rpglotd --proc-path ./mock_proc
```

**–û–ø—Ü–∏–∏:**
| –§–ª–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `-i, --interval` | –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–±–æ—Ä–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10) |
| `-o, --output` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: ./data) |
| `--proc-path` | –ü—É—Ç—å –∫ /proc (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) |
| `-v` | DEBUG —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤ |
| `-vv` | TRACE —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤ |
| `-q` | –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ (—Ç–∏—Ö–∏–π —Ä–µ–∂–∏–º) |

### rpglot ‚Äî TUI-–ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏.

```bash
# Live —Ä–µ–∂–∏–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): —Å–±–æ—Ä –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
rpglot              # –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è 1 —Å–µ–∫—É–Ω–¥–∞
rpglot 5            # –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è 5 —Å–µ–∫—É–Ω–¥

# History —Ä–µ–∂–∏–º: –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
rpglot -r ./data    # –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ ./data
rpglot -r -b -1h    # –Ω–∞—á–∞—Ç—å —Å –¥–∞–Ω–Ω—ã—Ö —á–∞—Å–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏
```

---

## –†–µ–∂–∏–º—ã TUI

### Live —Ä–µ–∂–∏–º vs History —Ä–µ–∂–∏–º

| –†–µ–∂–∏–º | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----------------|----------|
| **Live** | `/proc` + PostgreSQL | –°–±–æ—Ä –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ |
| **History** | –§–∞–π–ª—ã –Ω–∞ –¥–∏—Å–∫–µ | –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞–Ω–µ–µ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–µ–º–æ–Ω–æ–º rpglotd –¥–∞–Ω–Ω—ã—Ö |

**Live —Ä–µ–∂–∏–º:**
- –î–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ `/proc` –∏ PostgreSQL
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ —Ç–∞–π–º–µ—Ä—É (1-10 —Å–µ–∫)
- –ú–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø–∞—É–∑—É –∫–ª–∞–≤–∏—à–µ–π `Space`

**History —Ä–µ–∂–∏–º:**
- –î–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–æ–≤, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö rpglotd
- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏: `‚Üê/‚Üí` –∏–ª–∏ `t/T`
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏: `b` (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `-1h`, `16:00`, ISO 8601, Unix timestamp)

### Baremetal —Ä–µ–∂–∏–º vs Container —Ä–µ–∂–∏–º

TUI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ä–µ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:

**Baremetal (—Ñ–∏–∑–∏—á–µ—Å–∫–∏–π/–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä):**
- –ü–æ–ª–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö CPU —è–¥–µ—Ä
- –í—Å–µ –¥–∏—Å–∫–∏ –∏ —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- –°–≤–æ–ø –∏ –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–º—è—Ç–∏

**Container (cgroup):**
- CPU –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–≤–æ—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- –ü–∞–º—è—Ç—å —Å —É—á—ë—Ç–æ–º –ª–∏–º–∏—Ç–æ–≤ (`memory.max`)
- –¢–æ–ª—å–∫–æ –¥–∏—Å–∫–∏, –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- –°–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã: —Ç–æ–ª—å–∫–æ `eth*`/`veth*`
- –°–≤–æ–ø —Å–∫—Ä—ã—Ç (–Ω–µ –∞–∫—Ç—É–∞–ª–µ–Ω –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)

---

## –í–∫–ª–∞–¥–∫–∏ TUI

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏: `Tab`, `Shift+Tab` –∏–ª–∏ —Ü–∏—Ñ—Ä—ã `1`, `2`, `3`.

### PRC ‚Äî –ü—Ä–æ—Ü–µ—Å—Å—ã (Process)

–í–∫–ª–∞–¥–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å–∏—Å—Ç–µ–º—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ CPU, –ø–∞–º—è—Ç–∏ –∏ I/O.

**–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∞–≤–∏—à–∞–º–∏):**

| –ö–ª–∞–≤–∏—à–∞ | –†–µ–∂–∏–º | –ö–æ–ª–æ–Ω–∫–∏ |
|---------|-------|---------|
| `g` | Generic | PID, SYSCPU, USRCPU, RDELAY, VGROW, RGROW, RUID, EUID, ST, EXC, THR, S, CPUNR, CPU, CMD |
| `c` | Command | PID, TID, S, CPU, MEM, COMMAND-LINE (–ø–æ–ª–Ω–∞—è –∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞) |
| `m` | Memory | PID, TID, MINFLT, MAJFLT, VSTEXT, VSLIBS, VDATA, VSTACK, LOCKSZ, VSIZE, RSIZE, PSIZE, VGROW, RGROW, SWAPSZ, RUID, EUID, MEM, CMD |
| `d` | Disk | PID, RDDSK, WRDSK, WCANCL, DSK, CMD |

**–°–≤—è–∑—å —Å PGA:**
- –ï—Å–ª–∏ PID –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç backend PostgreSQL, –≤ –∫–æ–ª–æ–Ω–∫–µ CMD –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π SQL-–∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Ç–∏–ø backend (–Ω–∞–ø—Ä–∏–º–µ—Ä `[SELECT * FROM ...]` –∏–ª–∏ `[autovacuum worker]`)
- –ü—Ä–æ—Ü–µ—Å—Å—ã PostgreSQL –ø–æ–¥—Å–≤–µ—á–∏–≤–∞—é—Ç—Å—è **–≥–æ–ª—É–±—ã–º** —Ü–≤–µ—Ç–æ–º
- –ö–ª–∞–≤–∏—à–∞ `>` –∏–ª–∏ `J` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–µ—Å—Å–∏–∏ PostgreSQL –ø–æ PID (drill-down –≤ PGA)

### PGA ‚Äî PostgreSQL Activity

–í–∫–ª–∞–¥–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ PostgreSQL –∏–∑ `pg_stat_activity` —Å OS-–º–µ—Ç—Ä–∏–∫–∞–º–∏.

**–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:**

| –ö–ª–∞–≤–∏—à–∞ | –†–µ–∂–∏–º | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-------|----------|
| `g` | Generic | PID, CPU%, RSS, DB, USER, STATE, WAIT, QDUR, XDUR, BDUR, BTYPE, QUERY |
| `v` | Stats | PID, DB, USER, STATE, QDUR, MEAN, MAX, CALL/s, HIT%, QUERY (–æ–±–æ–≥–∞—â—ë–Ω –¥–∞–Ω–Ω—ã–º–∏ pg_stat_statements) |

**–ö–æ–ª–æ–Ω–∫–∏ Generic:**

| –ö–æ–ª–æ–Ω–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| PID | ID –ø—Ä–æ—Ü–µ—Å—Å–∞ backend PostgreSQL |
| CPU% | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU (–∏–∑ OS) |
| RSS | Resident Set Size (–∏–∑ OS) |
| DB | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |
| USER | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è PostgreSQL |
| STATE | –°–æ—Å—Ç–æ—è–Ω–∏–µ: active, idle, idle in transaction |
| WAIT | –°–æ–±—ã—Ç–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä Lock:tuple) |
| QDUR | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ |
| XDUR | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| BDUR | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ backend |
| BTYPE | –¢–∏–ø backend (client backend, autovacuum worker –∏ —Ç.–¥.) |
| QUERY | –¢–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ |

**–ö–æ–ª–æ–Ω–∫–∏ Stats (—Å –¥–∞–Ω–Ω—ã–º–∏ pg_stat_statements):**

| –ö–æ–ª–æ–Ω–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| MEAN | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ |
| MAX | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
| CALL/s | –í—ã–∑–æ–≤–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É |
| HIT% | –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ buffer cache |

**–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–Ω–æ–º–∞–ª–∏–π –≤ Stats —Ä–µ–∂–∏–º–µ:**
- üü° –ñ—ë–ª—Ç—ã–π: QDUR > 2√ó MEAN
- üî¥ –ö—Ä–∞—Å–Ω—ã–π: QDUR > 5√ó MEAN –∏–ª–∏ QDUR > MAX
- üü° –ñ—ë–ª—Ç—ã–π: HIT% < 80%
- üî¥ –ö—Ä–∞—Å–Ω—ã–π: HIT% < 50%

**–°–≤—è–∑–∏:**
- –° **PRC**: –ö–æ–ª–æ–Ω–∫–∏ CPU% –∏ RSS –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ OS-–ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ PID
- –° **PGS**: –ö–ª–∞–≤–∏—à–∞ `>` –∏–ª–∏ `J` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ query_id (drill-down –≤ PGS)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- `i` ‚Äî —Å–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å idle —Å–µ—Å—Å–∏–∏
- Idle —Å–µ—Å—Å–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º –≤–Ω–∏–∑—É —Å–ø–∏—Å–∫–∞

### PGS ‚Äî PostgreSQL Statements

–í–∫–ª–∞–¥–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ `pg_stat_statements` (TOP 500 –ø–æ `total_exec_time`).

**–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è:**

| –ö–ª–∞–≤–∏—à–∞ | –†–µ–∂–∏–º | –§–æ–∫—É—Å |
|---------|-------|-------|
| `t` | Time | –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (total/mean/min/max) |
| `c` | Calls | –ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–∑–æ–≤–æ–≤ (hot paths) |
| `i` | I/O | Shared buffer reads/hits/writes |
| `e` | Temp | Temp blocks / –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã spill |

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –º–µ—Ç—Ä–∏–∫ ‚Äî **rate** (–≤ —Å–µ–∫—É–Ω–¥—É, `/s`), –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –∏–∑ –¥–µ–ª—å—Ç –º–µ–∂–¥—É —Å–Ω–∏–º–∫–∞–º–∏
- –í –∑–∞–≥–æ–ª–æ–≤–∫–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–∫–∞–∑–∞–Ω–æ:
  - `dt=Xs` ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –¥–≤—É–º—è —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–Ω–∏–º–∫–∞–º–∏ pg_stat_statements
  - `age=Ys` ‚Äî –≤—Ä–µ–º—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–±–æ—Ä–∞

**–°–≤—è–∑—å —Å PGA:**
- –°–µ—Å—Å–∏–∏ –∏–∑ PGA –º–æ–≥—É—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω—ã —Å –∑–∞–ø–∏—Å—è–º–∏ PGS —á–µ—Ä–µ–∑ `query_id` (PostgreSQL 14+)

---

## Drill-down –Ω–∞–≤–∏–≥–∞—Ü–∏—è

Drill-down –ø–æ–∑–≤–æ–ª—è–µ—Ç "–ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è" –æ—Ç –æ–±—â–µ–≥–æ –∫ —á–∞—Å—Ç–Ω–æ–º—É:

```
PRC (–ø—Ä–æ—Ü–µ—Å—Å—ã) ‚Üí PGA (—Å–µ—Å—Å–∏–∏ PostgreSQL) ‚Üí PGS (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤)
```

| –û—Ç–∫—É–¥–∞ | –ö—É–¥–∞ | –ö–ª–∞–≤–∏—à–∞ | –°–≤—è–∑—å |
|--------|------|---------|-------|
| PRC | PGA | `>` –∏–ª–∏ `J` | –ü–æ PID –ø—Ä–æ—Ü–µ—Å—Å–∞ |
| PGA | PGS | `>` –∏–ª–∏ `J` | –ü–æ query_id |

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
1. –í PRC –≤–∏–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å postgres —Å –≤—ã—Å–æ–∫–∏–º CPU
2. –ù–∞–∂–∏–º–∞–µ—Ç–µ `>` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ PGA –∫ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
3. –í–∏–¥–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å, –Ω–∞–∂–∏–º–∞–µ—Ç–µ `>` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ PGS –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
4. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç–µ —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤, cache hit ratio

**–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è:**
- –ü–æ—Å–ª–µ drill-down –≤—ã–¥–µ–ª–µ–Ω–∏–µ "—Å–ª–µ–¥–∏—Ç" –∑–∞ PID –∏–ª–∏ query_id, –∞ –Ω–µ –∑–∞ –∏–Ω–¥–µ–∫—Å–æ–º —Å—Ç—Ä–æ–∫–∏
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤—ã–¥–µ–ª–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è/–∑–∞–ø—Ä–æ—Å –æ—Å—Ç–∞—ë—Ç—Å—è –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π

---

## –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ (Popup)

–ù–∞–∂–º–∏—Ç–µ `Enter` –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ popup-–æ–∫–Ω–∞.

### PRC ‚Äî –î–µ—Ç–∞–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞

| –°–µ–∫—Ü–∏—è | –ü–æ–ª—è |
|--------|------|
| Identity | PID, PPID, Name, Command, State, TTY, Start time, Threads |
| User/Group | Real UID/User, Effective UID/User, Real GID, Effective GID |
| CPU | CPU%, User time, System time, Current CPU, Run delay, Nice, Priority, RT Priority, Policy, I/O wait time, Vol. ctx sw/s, Invol. ctx sw/s |
| Memory | MEM%, Virtual, Resident, PSS, VGROW, RGROW, Code, Data, Stack, Libraries, Locked, Swap, Minor/Major faults |
| Disk I/O | Read ops, Read bytes, Write ops, Write bytes, Cancelled writes |

### PGA ‚Äî –î–µ—Ç–∞–ª–∏ —Å–µ—Å—Å–∏–∏ PostgreSQL

| –°–µ–∫—Ü–∏—è | –ü–æ–ª—è |
|--------|------|
| Session Identity | PID, Database, User, Application, Client Address, Backend Type |
| Timing | Backend Start, Transaction Start, Query Start, Query/Transaction/Backend Duration |
| State & Wait | State, Wait Event Type, Wait Event |
| OS Process | OS PID, Threads, State, User/System Time, CPU, Nice, Priority, Memory (Virtual/RSS/Shared/Swap), Page Faults, Disk I/O |
| Query | –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ (—Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π) |

### PGS ‚Äî –î–µ—Ç–∞–ª–∏ –∑–∞–ø—Ä–æ—Å–∞

| –°–µ–∫—Ü–∏—è | –ü–æ–ª—è |
|--------|------|
| Rates (/s) | calls/s, time_ms/s, I/O/s |
| Identity | queryid, db, user, calls, rows |
| Timing | total/mean/min/max/stddev, plan time |
| I/O | shared/local/temp blocks, cache hit% |
| Temp/WAL | temp blocks, estimated temp MB, WAL records/bytes |
| Query | –ü–æ–ª–Ω—ã–π –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ |

**–ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ popup:**
- `‚Üë/‚Üì`, `j/k` ‚Äî –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
- `PgUp/PgDn` ‚Äî –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
- `Enter` –∏–ª–∏ `Esc` ‚Äî –∑–∞–∫—Ä—ã—Ç—å

---

## –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏

### –û–±—â–∏–µ

| –ö–ª–∞–≤–∏—à–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `q` | –í—ã—Ö–æ–¥ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ: `q` –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏–ª–∏ `Enter`) |
| `Ctrl+C` | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ |
| `Tab`, `Shift+Tab` | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ |
| `1`, `2`, `3` | –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –≤–∫–ª–∞–¥–∫–µ (1=PRC, 2=PGA, 3=PGS) |
| `Space` | –ü–∞—É–∑–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ Live —Ä–µ–∂–∏–º) |
| `?`, `H` | –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Å–ø—Ä–∞–≤–∫—É |
| `Enter` | –û—Ç–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π popup |
| `Esc` | –ó–∞–∫—Ä—ã—Ç—å popup |

### –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ (History —Ä–µ–∂–∏–º)

| –ö–ª–∞–≤–∏—à–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `‚Üê`, `‚Üí` | –ü—Ä–µ–¥—ã–¥—É—â–∏–π/—Å–ª–µ–¥—É—é—â–∏–π —Å–Ω–∏–º–æ–∫ |
| `t` | –°–ª–µ–¥—É—é—â–∏–π —Å–Ω–∏–º–æ–∫ (–∫—Ä–æ–º–µ PGS, –≥–¥–µ `t` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞) |
| `T` | –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å–Ω–∏–º–æ–∫ |
| `b` | –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ |

### –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ç–∞–±–ª–∏—Ü–µ

| –ö–ª–∞–≤–∏—à–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `‚Üë/‚Üì`, `j/k` | –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä–æ–∫–∞–º |
| `PgUp/PgDn` | –ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è |
| `Home/End` | –í –Ω–∞—á–∞–ª–æ/–∫–æ–Ω–µ—Ü |
| `h/l` | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ (–¥–ª—è —à–∏—Ä–æ–∫–∏—Ö —Ç–∞–±–ª–∏—Ü) |

### –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

| –ö–ª–∞–≤–∏—à–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `s/S` | –°–ª–µ–¥—É—é—â–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ |
| `r/R` | –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ |
| `/` | –†–µ–∂–∏–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ |
| `p/P` | –†–µ–∂–∏–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (—Å—Ç–∏–ª—å atop) |
| `i/I` | PGA: —Å–∫—Ä—ã—Ç—å idle —Å–µ—Å—Å–∏–∏; PGS: –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ I/O —Ä–µ–∂–∏–º |
| `Esc` | –û—Ç–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä |
| `Enter` | –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä |

### Drill-down

| –ö–ª–∞–≤–∏—à–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `>`, `J` | –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–≤—è–∑–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏ (PRC‚ÜíPGA, PGA‚ÜíPGS) |

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π

**PRC:**
| –ö–ª–∞–≤–∏—à–∞ | –†–µ–∂–∏–º |
|---------|-------|
| `g/G` | Generic |
| `c/C` | Command |
| `m/M` | Memory |
| `d/D` | Disk |

**PGA:**
| –ö–ª–∞–≤–∏—à–∞ | –†–µ–∂–∏–º |
|---------|-------|
| `g/G` | Generic |
| `v/V` | Stats |

**PGS:**
| –ö–ª–∞–≤–∏—à–∞ | –†–µ–∂–∏–º |
|---------|-------|
| `t` | Time |
| `c` | Calls |
| `i` | I/O |
| `e` | Temp |

---

## Summary –ø–∞–Ω–µ–ª—å

–í –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–≤–æ–¥–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ –≤ –¥–≤—É—Ö–∫–æ–ª–æ–Ω–æ—á–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

**–õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–ø–∞–º—è—Ç—å/—Ö—Ä–∞–Ω–∏–ª–∏—â–µ/—Å–µ—Ç—å):**
- **MEM**: –û–±—â–∞—è –ø–∞–º—è—Ç—å, –¥–æ—Å—Ç—É–ø–Ω–∞—è, cache, buffers, slab
- **SWP**: –°–≤–æ–ø (total/free/used), dirty pages, writeback
- **DSK**: –î–∏—Å–∫–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (rMB/wMB/s, IOPS, await, util%)
- **NET**: –°–µ—Ç–µ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (rxMB/txMB/s, –ø–∞–∫–µ—Ç—ã, –æ—à–∏–±–∫–∏, drops)

**–ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (CPU/–Ω–∞–≥—Ä—É–∑–∫–∞):**
- **CPL**: Load average (1/5/15 –º–∏–Ω), –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- **CPU**: –û–±—â–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (sys/usr/irq/iow/idle/steal)
- **cpu**: –¢–æ–ø-5 —Å–∞–º—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —è–¥–µ—Ä
- **PSI**: Pressure Stall Information (CPU/MEM/I/O)
- **VMS**: Vmstat rates (pgin/pgout/swin/swout/flt/ctx –≤ —Å–µ–∫—É–Ω–¥—É)

**–¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∞–Ω–æ–º–∞–ª–∏–π:**
- üü° –ñ—ë–ª—Ç—ã–π ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- üî¥ –ö—Ä–∞—Å–Ω—ã–π ‚Äî –∫—Ä–∏—Ç–∏—á–Ω–æ

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# –ó–∞–ø—É—Å–∫ TUI —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 1 —Å–µ–∫—É–Ω–¥–∞
rpglot

# –° –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 5 —Å–µ–∫—É–Ω–¥ (–º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º—É)
rpglot 5
```

### –ó–∞–ø–∏—Å—å –∏ –∞–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏

```bash
# –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏
rpglotd -i 5 -o /var/log/rpglot

# –ü–æ–∑–∂–µ: –∞–Ω–∞–ª–∏–∑ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
rpglot -r /var/log/rpglot

# –ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–∞–Ω–Ω—ã–º —á–∞—Å–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏
rpglot -r /var/log/rpglot -b -1h

# –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏
rpglot -r /var/log/rpglot -b 2024-01-15T14:30:00
```

### –û—Ç–ª–∞–¥–∫–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ PostgreSQL

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `rpglot`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **PGA** (–∫–ª–∞–≤–∏—à–∞ `2`)
3. –ù–∞–π–¥–∏—Ç–µ —Å–µ—Å—Å–∏—é —Å –≤—ã—Å–æ–∫–∏–º **QDUR** (–æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–ª–∞–≤–∏—à–µ–π `s`)
4. –ù–∞–∂–º–∏—Ç–µ `Enter` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π
5. –ù–∞–∂–º–∏—Ç–µ `>` –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –≤ **PGS**
6. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ **HIT%**, **MEAN**, **MAX** –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
